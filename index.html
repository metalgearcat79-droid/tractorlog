<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex">
  <link rel="manifest" href="/tractorlog/manifest.json">
  <title>和農日向 Tractor Log</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      background-color: #f7f4ef;
      color: #3a3a3a;
      font-family: "Hiragino Sans", "Noto Sans JP", sans-serif;
      margin: 0;
      padding: 0;
    }
    .hidden { display: none; }
    .fade-in { animation: fadeIn 0.3s forwards; }
    .fade-out { animation: fadeOut 0.3s forwards; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to   { opacity: 0; transform: translateY(10px); }
    }
    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      position: relative;
    }
    .btn-main {
      background-color: #6b8f71;
      color: white;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      width: 100%;
      transition: all 0.2s;
    }
    .btn-main:active {
      background-color: #587a5f;
      transform: scale(0.98);
    }
    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
      z-index: 9998;
      display: none;
    }
    #sideMenu {
      position: fixed;
      top: 0;
      left: -280px;
      width: 280px;
      height: 100%;
      background: white;
      z-index: 9999;
      transition: left 0.3s ease;
      padding: 20px;
      padding-top: 60px;
    }
    @media (max-width: 480px) {
      #sideMenu { width: 240px; }
    }
    .view { display: none; padding: 20px; }
    .view.active { display: block; }

    /* メインコンテナの幅制御 */
    #mainContainer {
      width: 100%;
      max-width: 672px; /* 基本は 2xl 幅 */
      transition: max-width 0.3s ease;
    }
    /* ダッシュボード時のみ幅を広げる */
    #mainContainer.dashboard-active {
      max-width: 95% !important;
    }
  </style>
</head>

<body class="pb-10 bg-[#f7f4ef] text-gray-800">

<div id="overlay"></div>

<div id="sideMenu">
  <div class="menuContent">
    <div class="flex justify-between items-center mb-8">
      <h2 class="font-bold text-xl text-[#6b8f71]">メニュー</h2>
      <button id="closeMenuBtn" style="font-size: 36px; color: #aaa; line-height: 1;">&times;</button>
    </div>
    <nav class="space-y-4">
      <button onclick="switchView('inputView')" class="w-full text-left p-4 bg-[#f7f4ef] rounded-lg font-bold text-[#6b8f71] flex items-center">
        <i class="fa-solid fa-pen-to-square mr-3 text-lg"></i>ログ入力
      </button>
      <button onclick="switchView('todayView')" class="w-full text-left p-4 hover:bg-[#f7f4ef] rounded-lg font-bold flex items-center text-[#6b8f71]">
        <i class="fa-solid fa-calendar-day mr-3 text-lg"></i>本日の稼働状況
      </button>
      <button onclick="switchView('historyView')" class="w-full text-left p-4 hover:bg-[#f7f4ef] rounded-lg font-bold flex items-center text-[#6b8f71]">
        <i class="fa-solid fa-magnifying-glass mr-3 text-lg"></i>稼働履歴・検索
      </button>
      <button onclick="switchView('dashboard')" class="w-full text-left p-4 hover:bg-[#f7f4ef] rounded-lg font-bold flex items-center text-[#6b8f71]">
        <i class="fa-solid fa-chart-line mr-3 text-lg"></i>DASHBOARD
      </button>
    </nav>
  </div>
</div>

<div id="mainContainer" class="mx-auto">
  <header class="flex flex-col items-center justify-center py-10 relative">
    <button id="menuBtn" class="absolute left-4 top-4 sm:top-8 z-50 text-3xl text-[#6b8f71] p-2">
      <i class="fa-solid fa-bars"></i>
    </button>
    <i class="fa-solid fa-tractor text-4xl sm:text-7xl text-[#6b8f71] mb-2"></i>
    <h1 class="text-lg sm:text-2xl font-bold text-[#6b8f71] tracking-wider text-center">和農日向 Tractor log</h1>
  </header>

  <div id="inputView" class="view active">
    <div class="card mb-4">
      <label class="block text-sm font-medium text-gray-500 mb-1">機械を選択</label>
      <select id="machineSelect" class="w-full p-3 border rounded-lg bg-white outline-none focus:border-[#6b8f71]">
        <option value="">機械を選択してください</option>
      </select>
    </div>
    <div class="card mb-4">
      <label class="block text-sm font-medium text-gray-500 mb-1">作業日</label>
      <input type="date" id="workDate" class="w-full p-3 border rounded-lg outline-none" />
    </div>
    <div class="card mb-4">
      <label class="block text-sm font-medium text-gray-500 mb-1">オペレーター</label>
      <select id="operatorSelect" class="w-full p-3 border rounded-lg outline-none">
        <option value="選択してください">選択してください</option>
        <option value="阿曽 千一">阿曽 千一</option>
        <option value="阿曽 右貢">阿曽 右貢</option>
        <option value="菅原 亜美">菅原 亜美</option>
        <option value="土井 達也">土井 達也</option>
        <option value="阿曽 文平">阿曽 文平</option>
        <option value="田中 武志">田中 武志</option>
        <option value="赤塚 かおり">赤塚 かおり</option>
        <option value="土門 元義">土門 元義</option>
        <option value="その他">その他</option>
      </select>
    </div>
    <div class="card mb-4">
      <label class="block text-sm font-medium text-gray-500 mb-1">種別</label>
      <select id="categorySelect" class="w-full p-3 border rounded-lg outline-none">
        <option value="">選択してください</option>
        <option value="水稲">水稲</option>
        <option value="そば">そば</option>
        <option value="保全会">保全会</option>
        <option value="小規模工事">小規模工事</option>
        <option value="その他">その他</option>
      </select>
    </div>
    <div class="card mb-4">
      <label class="block text-sm font-medium text-gray-500 mb-1">作業内容</label>
      <select id="taskSelect" class="w-full p-3 border rounded-lg outline-none"></select>
    </div>
    <div class="card mb-4">
      <div class="flex space-x-4">
        <div class="flex-1">
          <label class="block text-sm font-medium text-gray-500 mb-1">稼働前メーター</label>
          <input type="number" id="hourBefore" class="w-full p-3 border rounded-lg mt-1" step="0.1" />
        </div>
        <div class="flex-1">
          <label class="block text-sm font-medium text-gray-500 mb-1">稼働後メーター</label>
          <input type="number" id="hourAfter" class="w-full p-3 border rounded-lg mt-1" step="0.1" />
        </div>
      </div>
    </div>
    <div id="hourDiffDisplay" class="text-right font-bold text-[#6b8f71] mb-6 text-lg">
      稼働時間: 0.0 h
    </div>
    <div class="card mb-6">
      <label class="block text-sm font-medium text-gray-500 mb-1">メモ</label>
      <textarea id="memoInput" class="w-full p-3 border rounded-lg outline-none" rows="3" placeholder="備考など"></textarea>
    </div>
    <button id="saveBtn" class="btn-main text-base py-3">保存する</button>
  </div>

  <div id="savePopup" class="hidden fixed inset-0 flex items-center justify-center z-50">
    <div class="px-6 py-3 rounded-lg text-white text-lg shadow-lg" style="background-color: #2f5d3a;">
      保存しました
    </div>
  </div>

  <div id="todayView" class="view">
    <div class="flex justify-between items-center border-b-2 border-[#6b8f71] pb-3 mb-6">
      <h2 class="text-xl font-bold text-[#6b8f71] flex items-center">
        <i class="fa-solid fa-calendar-day mr-2"></i>本日の稼働状況
      </h2>
      <button onclick="loadTodayLogs()" class="text-sm bg-white px-3 py-1 rounded-lg shadow text-gray-600 active:scale-95">
        <i class="fa-solid fa-rotate"></i> 更新
      </button>
    </div>
    <div id="todayLogList" class="space-y-4 mb-10"></div>
    <button onclick="switchView('inputView')" class="w-full py-4 bg-gray-200 text-gray-700 rounded-xl font-bold flex items-center justify-center shadow-sm active:bg-gray-300">
      <i class="fa-solid fa-circle-arrow-left mr-2 text-xl"></i>TOPに戻る
    </button>
  </div>

  <div id="historyView" class="view">
    <div class="flex justify-between items-center border-b-2 border-[#6b8f71] pb-3 mb-6">
      <h2 class="text-xl font-bold text-[#6b8f71] flex items-center">
        <i class="fa-solid fa-magnifying-glass mr-2"></i>過去の履歴・検索
      </h2>
      <div id="historyTotalHours" class="text-sm font-bold bg-[#6b8f71] text-white px-3 py-1 rounded-full">
        合計: 0.0 h
      </div>
    </div>
    <div